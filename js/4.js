(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{605:function(e,t,a){"use strict";a.r(t);var s=a(242),i=a.n(s),r=a(342),n=a.n(r),o=a(175),l=a.n(o),c=a(176),u=a.n(c),d=a(411),p=a.n(d),b=a(177),m=a.n(b),v=a(131),f=a.n(v),h=a(178),y=a.n(h),g=a(571),E=a.n(g),k=a(21),S=a.n(k),_=a(1),w=a.n(_),z=a(118),R=a(162),x=a(581),C=a(179),O=a(353),q=a(354),N=a(352),U=a(355),I=a(351),j=a(357),A=a(381),T=a(358),D=a(359),F=a(360),H=a(382),P=a(106),B=a(580);function J(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var L=function(e){return w.a.createElement(O.a,{isHorizontal:!0},w.a.createElement(q.a,{label:"Release",fieldId:"release-select"},w.a.createElement(N.a,{value:e.value,onChange:function(t){return e.setRelease(t)},"aria-label":"Select release input",id:"release-select","data-testid":"release-select"},[{value:"rhel-8",label:"Red Hat Enterprise Linux (RHEL) 8.2"}].map((function(e){return w.a.createElement(U.a,{key:e.value,value:e.value,label:e.label})})))))};L.propTypes={setRelease:S.a.func,value:S.a.string};var M=function(e){return w.a.createElement(w.a.Fragment,null,w.a.createElement(q.a,{isRequired:!0,label:"Access key ID",fieldId:"amazon-access-id",helperTextInvalid:e.errors["amazon-access-id"]&&e.errors["amazon-access-id"].value||"",validated:e.errors["amazon-access-id"]?"error":"default"},w.a.createElement(I.a,{value:e.upload.options.access_key_id||"",type:"text","aria-label":"amazon access key ID",id:"amazon-access-id","data-testid":"aws-access-key",isRequired:!0,onChange:function(t){return e.setUploadOptions(Object.assign(e.upload.options,{access_key_id:t}))}})),w.a.createElement(q.a,{isRequired:!0,label:"Secret access key",fieldId:"amazon-access-secret",helperTextInvalid:e.errors["amazon-access-secret"]&&e.errors["amazon-access-secret"].value||"",validated:e.errors["amazon-access-secret"]?"error":"default"},w.a.createElement(I.a,{value:e.upload.options.secret_access_key||"","data-testid":"aws-secret-access-key",isRequired:!0,type:"password","aria-label":"amazon secret access key",id:"amazon-access-secret",onChange:function(t){return e.setUploadOptions(Object.assign(e.upload.options,{secret_access_key:t}))}})),w.a.createElement(q.a,{isRequired:!0,label:"Service",fieldId:"amazon-service"},w.a.createElement(N.a,{value:e.upload.options.service,"aria-label":"Select amazon service",id:"amazon-service","data-testid":"aws-service-select",onChange:function(t){return e.setUploadOptions(Object.assign(e.upload.options,{service:t}))}},[{value:"ec2",label:"Amazon Elastic Compute Cloud (ec2)"},{value:"s3",label:"Amazon Simple Storage Service (s3)"}].map((function(e){return w.a.createElement(U.a,{key:e.value,value:e.value,label:e.label})})))),w.a.createElement(q.a,{isRequired:!0,label:"Region",fieldId:"amazon-region",helperTextInvalid:e.errors["amazon-region"]&&e.errors["amazon-region"].value||"",validated:e.errors["amazon-region"]?"error":"default"},w.a.createElement(I.a,{value:e.upload.options.region,type:"text","aria-label":"amazon region",id:"amazon-region","data-testid":"aws-region",isRequired:!0,onChange:function(t){return e.setUploadOptions(Object.assign(e.upload.options,{region:t}))}})),"s3"===e.upload.options.service&&w.a.createElement(q.a,{isRequired:!0,label:"Bucket",fieldId:"amazon-bucket",helperTextInvalid:e.errors["amazon-bucket"]&&e.errors["amazon-bucket"].value||"",validated:e.errors["amazon-bucket"]?"error":"default"},w.a.createElement(I.a,{value:e.upload.options.bucket||"",type:"text","aria-label":"amazon bucket",id:"amazon-bucket","data-testid":"aws-bucket",isRequired:!0,onChange:function(t){return e.setUploadOptions(Object.assign(e.upload.options,{bucket:t}))}})))};M.propTypes={setUploadOptions:S.a.func,upload:S.a.object,errors:S.a.object};var G=function(e){return w.a.createElement(w.a.Fragment,null,w.a.createElement(O.a,{isHorizontal:!0},w.a.createElement(q.a,{isRequired:!0,label:"Destination",fieldId:"upload-destination"},w.a.createElement(N.a,{value:e.upload.type||"",id:"upload-destination","data-testid":"upload-destination",isRequired:!0,onChange:function(t){return e.setUpload({type:t,options:e.upload.options})},"aria-label":"Select upload destination"},[{value:"aws",label:"Amazon Machine Image (.raw)"}].map((function(e){return w.a.createElement(U.a,{key:e.value,value:e.value,label:e.label})})))),"aws"===e.upload.type&&w.a.createElement(M,{upload:e.upload,setUploadOptions:e.setUploadOptions,errors:e.errors})))};G.propTypes={setUpload:S.a.func,setUploadOptions:S.a.func,upload:S.a.object,errors:S.a.object};var K=function(e){return w.a.createElement(O.a,null,w.a.createElement(q.a,{isRequired:!0,label:"Register the system",fieldId:"subscribe-radio"},w.a.createElement(j.a,{name:"subscribe-radio",isChecked:e.subscribeNow,id:"subscribe-radio",label:"Embed an activation key and register systems on first boot",onChange:function(){return e.setSubscribeNow(!0)},"data-testid":"register-now-radio-button"}),w.a.createElement(j.a,{name:"subscribe-radio",isChecked:!e.subscribeNow,label:"Register the system later",id:"subscribe-radio",onChange:function(){return e.setSubscribeNow(!1)},"data-testid":"register-later-radio-button"})),e.subscribeNow&&w.a.createElement(w.a.Fragment,null,w.a.createElement(q.a,{label:"Organization ID",fieldId:"subscription-organization"},w.a.createElement(I.a,{isDisabled:!0,value:e.subscription.organization||"",type:"text",id:"subscription-organization","aria-label":"Subscription organization ID","data-testid":"organization-id"})),w.a.createElement(q.a,{isRequired:!0,label:"Activation key",fieldId:"subscription-activation",helperTextInvalid:e.errors["subscription-activation"]&&e.errors["subscription-activation"].value||"",validated:e.errors["subscription-activation"]?"error":"default"},w.a.createElement(I.a,{value:e.subscription["activation-key"]||"",type:"password","data-testid":"subscription-activation",isRequired:!0,id:"subscription-activation","aria-label":"Subscription activation key",onChange:function(t){return e.setSubscription(Object.assign(e.subscription,{"activation-key":t}))}}))))};K.propTypes={setSubscription:S.a.func,setSubscribeNow:S.a.func,subscription:S.a.object,subscribeNow:S.a.bool,errors:S.a.object};var Q=function(e){return w.a.createElement(w.a.Fragment,null,(Object.keys(e.uploadErrors).length>0||Object.keys(e.subscriptionErrors).length>0)&&w.a.createElement(A.a,{variant:"danger",isInline:!0,title:"Required information is missing"}),w.a.createElement(T.a,null,w.a.createElement("h2",null,"Create image"),w.a.createElement("small",null,"Review the information and click Create image to create the image using the following criteria."),w.a.createElement("h3",null,"Release"),w.a.createElement(D.a,null,w.a.createElement(F.a,{flex:{default:"flex_1"}},"Release"),w.a.createElement(F.a,{flex:{default:"flex_2"}},e.release)),w.a.createElement("h3",null,"Image output"),w.a.createElement(D.a,null,w.a.createElement(F.a,{flex:{default:"flex_1"}},"Destination"),w.a.createElement(F.a,{flex:{default:"flex_2"}},e.upload&&w.a.createElement(w.a.Fragment,null,e.upload.type))),Object.entries(e.uploadErrors).map((function(e){var t=E()(e,2),a=t[0],s=t[1];return w.a.createElement(D.a,{key:a},w.a.createElement(F.a,{flex:{default:"flex_1"}},s.label),w.a.createElement(F.a,{flex:{default:"flex_2"}},w.a.createElement(P.a,{className:"error"})," ",s.value))})),w.a.createElement("h3",null,"Registration"),w.a.createElement(D.a,null,w.a.createElement(F.a,{flex:{default:"flex_1"}},"Subscription"),!e.subscribeNow&&w.a.createElement(F.a,{flex:{default:"flex_2"}},"Register the system later"),e.subscribeNow&&w.a.createElement(F.a,{flex:{default:"flex_2"}},"Register the system on first boot")),Object.entries(e.subscriptionErrors).map((function(e){var t=E()(e,2),a=t[0],s=t[1];return w.a.createElement(D.a,{key:a},w.a.createElement(F.a,{flex:{default:"flex_1"}},s.label),w.a.createElement(F.a,{flex:{default:"flex_2"}},w.a.createElement(P.a,{className:"error"})," ",s.value))}))))};Q.propTypes={release:S.a.string,upload:S.a.object,subscription:S.a.object,subscribeNow:S.a.bool,uploadErrors:S.a.object,subscriptionErrors:S.a.object};var V=function(e){y()(r,e);var t,a,s=(t=r,function(){var e,a=f()(t);if(J()){var s=f()(this).constructor;e=Reflect.construct(a,arguments,s)}else e=a.apply(this,arguments);return m()(this,e)});function r(e){var t;return l()(this,r),(t=s.call(this,e)).setRelease=t.setRelease.bind(p()(t)),t.setUpload=t.setUpload.bind(p()(t)),t.setUploadOptions=t.setUploadOptions.bind(p()(t)),t.setSubscription=t.setSubscription.bind(p()(t)),t.setSubscribeNow=t.setSubscribeNow.bind(p()(t)),t.onStep=t.onStep.bind(p()(t)),t.onSave=t.onSave.bind(p()(t)),t.onClose=t.onClose.bind(p()(t)),t.validate=t.validate.bind(p()(t)),t.validateUploadAmazon=t.validateUploadAmazon.bind(p()(t)),t.validateSubscription=t.validateSubscription.bind(p()(t)),t.state={release:"rhel-8",upload:{type:"aws",options:{service:"ec2",region:"eu-west-2",access_key_id:null,secret_access_key:null,bucket:null}},subscription:{organization:null,"activation-key":null,"server-url":"subscription.rhsm.redhat.com","base-url":"https://cdn.redhat.com/",insights:!0},subscribeNow:!1,uploadErrors:{},subscriptionErrors:{}},t}return u()(r,[{key:"componentDidMount",value:(a=n()(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,insights.chrome.auth.getUser();case 2:t=e.sent,this.setState({subscription:{organization:Number(t.identity.internal.org_id)}});case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"onStep",value:function(e){"Review"===e.name&&this.validate()}},{key:"validate",value:function(){"aws"===this.state.upload.type?this.validateUploadAmazon():this.setState({uploadErrors:{}}),this.state.subscribeNow?this.validateSubscription():this.setState({subscriptionErrors:{}})}},{key:"validateUploadAmazon",value:function(){var e={};this.state.upload.options.access_key_id||(e["amazon-access-id"]={label:"Access key ID",value:"A value is required"}),this.state.upload.options.secret_access_key||(e["amazon-access-secret"]={label:"Secret access key",value:"A value is required"}),this.state.upload.options.region||(e["amazon-region"]={label:"Region",value:"A value is required"}),"s3"!==this.state.upload.options.service||this.state.upload.options.bucket||(e["amazon-bucket"]={label:"Bucket",value:"A value is required"}),this.setState({uploadErrors:e})}},{key:"validateSubscription",value:function(){var e={};this.state.subscription["activation-key"]||(e["subscription-activation"]={label:"Activation key",value:"A value is required"}),this.setState({subscriptionErrors:e})}},{key:"setRelease",value:function(e){this.setState({release:e})}},{key:"setUpload",value:function(e){this.setState({upload:e})}},{key:"setUploadOptions",value:function(e){this.setState((function(t){return{upload:{type:t.upload.type,options:e}}}))}},{key:"setSubscribeNow",value:function(e){this.setState({subscribeNow:e})}},{key:"setSubscription",value:function(e){this.setState({subscription:e},this.validate)}},{key:"onSave",value:function(){var e=this,t={distribution:this.state.release,image_requests:[{architecture:"x86_64",image_type:"qcow2",upload_requests:[{type:"aws",options:{region:this.state.upload.options.region,s3:{access_key_id:this.state.upload.options.access_key_id,secret_access_key:this.state.upload.options.secret_access_key,bucket:this.state.upload.options.bucket},ec2:{access_key_id:this.state.upload.options.access_key_id,secret_access_key:this.state.upload.options.secret_access_key}}}]}],customizations:{subscription:this.state.subscription}},a=this.props.updateCompose;B.a.composeImage(t).then((function(s){var i={};i[s.id]={status:"request sent",distribution:t.distribution,architecture:t.image_requests[0].architecture,image_type:t.image_requests[0].image_type},a(i),e.props.history.push("/landing")}))}},{key:"onClose",value:function(){this.props.history.push("/landing")}},{key:"render",value:function(){var e=[{name:"Release",component:w.a.createElement(L,{value:this.state.release,setRelease:this.setRelease})},{name:"Target environment",component:w.a.createElement(G,{upload:this.state.upload,setUpload:this.setUpload,setUploadOptions:this.setUploadOptions,errors:this.state.uploadErrors})},{name:"Registration",component:w.a.createElement(K,{subscription:this.state.subscription,subscribeNow:this.state.subscribeNow,setSubscription:this.setSubscription,setSubscribeNow:this.setSubscribeNow,errors:this.state.subscriptionErrors})},{name:"Review",component:w.a.createElement(Q,{release:this.state.release,upload:this.state.upload,subscription:this.state.subscription,subscribeNow:this.state.subscribeNow,uploadErrors:this.state.uploadErrors,subscriptionErrors:this.state.subscriptionErrors}),nextButtonText:"Create"}];return w.a.createElement(w.a.Fragment,null,w.a.createElement(C.PageHeader,null,w.a.createElement(C.PageHeaderTitle,{title:"Create a new image"})),w.a.createElement(H.a,{onNext:this.onStep,onGoToStep:this.onStep,isInPage:!0,steps:e,onClose:this.onClose,onSave:this.onSave}))}}]),r}(_.Component);V.propTypes={updateCompose:S.a.func,history:S.a.object},t.default=Object(R.connect)(null,(function(e){return{updateCompose:function(t){return e(x.a.updateCompose(t))}}}))(Object(z.o)(V))}}]);
//# sourceMappingURL=4.js.map